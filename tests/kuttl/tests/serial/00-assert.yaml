# Check placement rules
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: serial-1
  namespace: default
spec:
  clusterConditions:
  - status: "True"
    type: ManagedClusterConditionAvailable
  clusters:
  - name: spoke1
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: serial-2
  namespace: default
spec:
  clusterConditions:
  - status: "True"
    type: ManagedClusterConditionAvailable
  clusters:
  - name: spoke2
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: serial-3
  namespace: default
spec:
  clusterConditions:
  - status: "True"
    type: ManagedClusterConditionAvailable
  clusters:
  - name: spoke3
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: serial-4
  namespace: default
spec:
  clusterConditions:
  - status: "True"
    type: ManagedClusterConditionAvailable
  clusters:
  - name: spoke4
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: serial-5
  namespace: default
spec:
  clusterConditions:
  - status: "True"
    type: ManagedClusterConditionAvailable
  clusters:
  - name: spoke5
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: serial-6
  namespace: default
spec:
  clusterConditions:
  - status: "True"
    type: ManagedClusterConditionAvailable
  clusters:
  - name: spoke6
# Check placement bindings
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: serial-1
  namespace: default
placementRef:
  apiGroup: apps.open-cluster-management.io
  kind: PlacementRule
  name: serial-1
subjects:
- apiGroup: policy.open-cluster-management.io
  kind: Policy
  name: serial-platform-1
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: serial-2
  namespace: default
placementRef:
  apiGroup: apps.open-cluster-management.io
  kind: PlacementRule
  name: serial-2
subjects:
- apiGroup: policy.open-cluster-management.io
  kind: Policy
  name: serial-platform-2
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: serial-3
  namespace: default
placementRef:
  apiGroup: apps.open-cluster-management.io
  kind: PlacementRule
  name: serial-3
subjects:
- apiGroup: policy.open-cluster-management.io
  kind: Policy
  name: serial-platform-3
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: serial-4
  namespace: default
placementRef:
  apiGroup: apps.open-cluster-management.io
  kind: PlacementRule
  name: serial-4
subjects:
- apiGroup: policy.open-cluster-management.io
  kind: Policy
  name: serial-platform-4
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: serial-5
  namespace: default
placementRef:
  apiGroup: apps.open-cluster-management.io
  kind: PlacementRule
  name: serial-5
subjects:
- apiGroup: policy.open-cluster-management.io
  kind: Policy
  name: serial-platform-5
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: serial-6
  namespace: default
placementRef:
  apiGroup: apps.open-cluster-management.io
  kind: PlacementRule
  name: serial-6
subjects:
- apiGroup: policy.open-cluster-management.io
  kind: Policy
  name: serial-platform-6
# Check generated policies
---
apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    policy.open-cluster-management.io/standards: NIST SP 800-53
  labels:
    app: openshift-cluster-group-upgrades
    openshift-cluster-group-upgrades/batch: "1"
    openshift-cluster-group-upgrades/clusterGroupUpgrade: serial
    openshift-cluster-group-upgrades/policyType: platformUpgrade
  name: serial-platform-1
  namespace: default
spec:
  disabled: false
  policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: upgrade-cluster
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            spec:
              channel: stable-4.8
              desiredUpdate:
                force: true
                image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                version: 4.8.1
              upstream: https://amd64.ocp.releases.ci.openshift.org/graph
        remediationAction: inform
        severity: high
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-available
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "False"
                type: Available
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-not-degraded
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "True"
                type: Degraded
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: check-installed-version-status
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            status:
              history:
              - image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                state: Completed
                version: 4.8.1
        remediationAction: inform
        severity: high
  remediationAction: inform
---
apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    policy.open-cluster-management.io/standards: NIST SP 800-53
  labels:
    app: openshift-cluster-group-upgrades
    openshift-cluster-group-upgrades/batch: "2"
    openshift-cluster-group-upgrades/clusterGroupUpgrade: serial
    openshift-cluster-group-upgrades/policyType: platformUpgrade
  name: serial-platform-2
  namespace: default
spec:
  disabled: false
  policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: upgrade-cluster
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            spec:
              channel: stable-4.8
              desiredUpdate:
                force: true
                image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                version: 4.8.1
              upstream: https://amd64.ocp.releases.ci.openshift.org/graph
        remediationAction: inform
        severity: high
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-available
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "False"
                type: Available
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-not-degraded
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "True"
                type: Degraded
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: check-installed-version-status
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            status:
              history:
              - image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                state: Completed
                version: 4.8.1
        remediationAction: inform
        severity: high
  remediationAction: inform
---
apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    policy.open-cluster-management.io/standards: NIST SP 800-53
  labels:
    app: openshift-cluster-group-upgrades
    openshift-cluster-group-upgrades/batch: "3"
    openshift-cluster-group-upgrades/clusterGroupUpgrade: serial
    openshift-cluster-group-upgrades/policyType: platformUpgrade
  name: serial-platform-3
  namespace: default
spec:
  disabled: false
  policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: upgrade-cluster
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            spec:
              channel: stable-4.8
              desiredUpdate:
                force: true
                image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                version: 4.8.1
              upstream: https://amd64.ocp.releases.ci.openshift.org/graph
        remediationAction: inform
        severity: high
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-available
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "False"
                type: Available
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-not-degraded
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "True"
                type: Degraded
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: check-installed-version-status
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            status:
              history:
              - image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                state: Completed
                version: 4.8.1
        remediationAction: inform
        severity: high
  remediationAction: inform
---
apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    policy.open-cluster-management.io/standards: NIST SP 800-53
  labels:
    app: openshift-cluster-group-upgrades
    openshift-cluster-group-upgrades/batch: "4"
    openshift-cluster-group-upgrades/clusterGroupUpgrade: serial
    openshift-cluster-group-upgrades/policyType: platformUpgrade
  name: serial-platform-4
  namespace: default
spec:
  disabled: false
  policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: upgrade-cluster
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            spec:
              channel: stable-4.8
              desiredUpdate:
                force: true
                image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                version: 4.8.1
              upstream: https://amd64.ocp.releases.ci.openshift.org/graph
        remediationAction: inform
        severity: high
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-available
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "False"
                type: Available
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-not-degraded
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "True"
                type: Degraded
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: check-installed-version-status
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            status:
              history:
              - image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                state: Completed
                version: 4.8.1
        remediationAction: inform
        severity: high
  remediationAction: inform
---
apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    policy.open-cluster-management.io/standards: NIST SP 800-53
  labels:
    app: openshift-cluster-group-upgrades
    openshift-cluster-group-upgrades/batch: "5"
    openshift-cluster-group-upgrades/clusterGroupUpgrade: serial
    openshift-cluster-group-upgrades/policyType: platformUpgrade
  name: serial-platform-5
  namespace: default
spec:
  disabled: false
  policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: upgrade-cluster
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            spec:
              channel: stable-4.8
              desiredUpdate:
                force: true
                image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                version: 4.8.1
              upstream: https://amd64.ocp.releases.ci.openshift.org/graph
        remediationAction: inform
        severity: high
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-available
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "False"
                type: Available
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-not-degraded
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "True"
                type: Degraded
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: check-installed-version-status
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            status:
              history:
              - image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                state: Completed
                version: 4.8.1
        remediationAction: inform
        severity: high
  remediationAction: inform
---
apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    policy.open-cluster-management.io/standards: NIST SP 800-53
  labels:
    app: openshift-cluster-group-upgrades
    openshift-cluster-group-upgrades/batch: "6"
    openshift-cluster-group-upgrades/clusterGroupUpgrade: serial
    openshift-cluster-group-upgrades/policyType: platformUpgrade
  name: serial-platform-6
  namespace: default
spec:
  disabled: false
  policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: upgrade-cluster
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            spec:
              channel: stable-4.8
              desiredUpdate:
                force: true
                image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                version: 4.8.1
              upstream: https://amd64.ocp.releases.ci.openshift.org/graph
        remediationAction: inform
        severity: high
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-available
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "False"
                type: Available
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-upgrade-check-co-not-degraded
      spec:
        namespaceSelector:
          exclude:
          - kube-*
          include:
          - default
        object-templates:
        - complianceType: mustnothave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterOperator
            status:
              conditions:
              - status: "True"
                type: Degraded
        remediationAction: inform
        severity: low
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: check-installed-version-status
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: ClusterVersion
            metadata:
              name: version
            status:
              history:
              - image: quay.io/openshift-release-dev/ocp-release:4.8.1-x86_64
                state: Completed
                version: 4.8.1
        remediationAction: inform
        severity: high
  remediationAction: inform
